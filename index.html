<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGL Application</title>
</head>
<body>
    <canvas id="glCanvas" width="800" height="600"></canvas>
    <script>
        // Create a canvas element
        const canvas = document.createElement('canvas');
        canvas.width = 800;
        canvas.height = 600;
        document.body.appendChild(canvas);

        // Initialize the WebGPU context
        async function init() {
        const adapter = await navigator.gpu.requestAdapter();
        const device = await adapter.requestDevice();

        // Create a WebGPU context
        const context = canvas.getContext('gpupresent');

        // Define the vertex data for a triangle
        const vertices = new Float32Array([
            0.0,  0.5, 0.0,
        -0.5, -0.5, 0.0,
            0.5, -0.5, 0.0,
        ]);

        // Create a buffer to store the vertex data
        const buffer = device.createBuffer({
            size: vertices.byteLength,
            usage: GPUBufferUsage.VERTEX,
            mappedAtCreation: true,
        });
        new Float32Array(buffer.getMappedRange()).set(vertices);
        buffer.unmap();

        // Load and compile shaders (vertex and fragment shaders)
        const vertexShaderModule = device.createShaderModule({
            code: `
            #version 450
            layout(location = 0) in vec3 inPosition;
            void main() {
                gl_Position = vec4(inPosition, 1.0);
            }
            `,
        });

        const fragmentShaderModule = device.createShaderModule({
            code: `
            #version 450
            layout(location = 0) out vec4 fragColor;
            void main() {
                fragColor = vec4(1.0, 0.0, 0.0, 1.0); // Red color for lines
            }
            `,
        });

        // Create a pipeline layout
        const pipelineLayout = device.createPipelineLayout({ bindGroupLayouts: [] });

        // Create a texture and a texture view manually
        const textureDescriptor = {
            size: { width: canvas.width, height: canvas.height, depthOrArrayLayers: 1 },
            format: 'rgba8unorm',
            usage: GPUTextureUsage.RENDER_ATTACHMENT | GPUTextureUsage.COPY_SRC,
        };
        const texture = device.createTexture(textureDescriptor);
        const textureView = texture.createView();

        // Create a render pipeline
        const pipeline = device.createRenderPipeline({
            layout: pipelineLayout,
            vertex: {
            module: vertexShaderModule,
            entryPoint: 'main',
            },
            fragment: {
            module: fragmentShaderModule,
            entryPoint: 'main',
            targets: [
                {
                format: 'rgba8unorm',
                view: textureView,
                loadValue: { r: 0.0, g: 0.0, b: 0.0, a: 1.0 },
                storeOp: 'store',
                },
            ],
            },
            primitive: {
            topology: 'triangle-list',
            },
        });

        // Create a bind group
        const bindGroup = device.createBindGroup({
            layout: pipeline.getBindGroupLayout(0),
            entries: [
            {
                binding: 0,
                resource: {
                buffer: buffer,
                offset: 0,
                size: vertices.byteLength,
                },
            },
            ],
        });

        // Create a command encoder
        const commandEncoder = device.createCommandEncoder();

        // Begin a render pass
        const renderPassDescriptor = {
            colorAttachments: [
            {
                view: textureView,
                loadValue: { r: 0.0, g: 0.0, b: 0.0, a: 1.0 },
                storeOp: 'store',
            },
            ],
        };
        const passEncoder = commandEncoder.beginRenderPass(renderPassDescriptor);
        passEncoder.setPipeline(pipeline);
        passEncoder.setBindGroup(0, bindGroup);
        passEncoder.draw(3, 1, 0, 0);
        passEncoder.endPass();

        // Finish rendering
        device.queue.submit([commandEncoder.finish()]);

        // Present the texture on the canvas
        context.present(textureView);
        }

        init();


    </script>
</body>
</html>